id: demo2_analyze_site
title: Analyze Site
introduction:
  format: markdown
  template: |
    We will now analyze {{project}}.

questions:
  - prompt: What is the url of the project?
    id: project_url
    title: URL
    type: url
    help: e.g., http://www.yoursite.gov

  - id: analysis
    title: Analyze
    prompt: We will analyze {{project_url}}.
    type: external-function
    function: guidedmodules.sample_external_functions.sample_function
    ask-first:
      - project_url

output:
  - title: Analysis Result
    format: markdown
    template: |
      {% if not analysis %}
      Not yet analyzed.

      {% elif analysis.url != project_url %}
      Analysis results are out of date because the project URL has changed. Please re-scan.

      {% elif 'schema' not in analysis or analysis.schema != 1 %}
      Analysis results are out of date because a new analysis is available. Please re-scan.

      {% else %}
      URL: {{analysis.url}}

      Date: {{analysis.scan_date}}

      {% if 'expires' in analysis.result.domain %}
      Domain Name Expiration Date: {{analysis.result.domain.expires}}
      {% endif %}

      {% if not analysis.result.domain.ssl.allowed %}
      TLS (SSL): Not available on this website.
      {% else %}
      TLS (SSL) Certificate Expiration Date: {{analysis.result.domain.ssl.expires}}
      {% endif %}

      {% if analysis.result.wappalyzer %}
      Uses:
      {% for item in analysis.result.wappalyzer.values() %}
      * {{item.app}} {{item.version}}
      {% endfor %}
      {% endif %}

      {% endif %}