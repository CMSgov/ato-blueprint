{% extends "base.html" %}

{% block title %}
{{m.title}}
{% endblock %}

{% block body %}
<style>
#finished-tabs-panels .tab-pane {
  border-left: 1px solid #ddd;
  border-right: 1px solid #ddd;
  border-bottom: 1px solid #ddd;
  padding: 30px 15px;
}

.output-document {
  background-color: #FBF6F4;
  color: black;
}
#finished-tabs .active.for-output-document a {
  background-color: #FBF6F4;
}
</style>

<div class="row">
  <div class="col-sm-push-2 col-sm-8">

{% include "task-header.html" with col_width="4" col_active="review" %}

<div style="margin: 2em 0">
  {% with supermodule=task.is_answer_to_unique %}
    {% if supermodule and supermodule.task.editor == request.user %}
      <p class="text-">...and we're done <span class="glyphicon glyphicon-ok"></p>

    {% else %}
      {# every task, except projects, are now subtasks of other tasks, so this only occurs if a task is a subtask to multiple super-tasks #}
      <p class="text-success"><span class="glyphicon glyphicon-ok"></span> Module complete. Continue with <a href="{{task.project.get_absolute_url}}">other modules in {{task.project.title}}</a>.</p>
    {% endif %}
  {% endwith %}

</div>

<div>
  <ul id="finished-tabs" class="nav nav-tabs" role="tablist">
    {% for document in output %}
      <li role="presentation" class="{% if forloop.first %}active{% endif %} for-output-document"><a href="#document-{{forloop.counter}}" aria-controls="document-{{forloop.counter}}" role="tab" data-toggle="tab">{{document.title}}</a></li>
    {% endfor %}
    <li role="presentation"><a href="#questions" aria-controls="questions" role="tab" data-toggle="tab">Change Answers</a></li>
  </ul>

  <!-- Tab panes -->
  <div id="finished-tabs-panels" class="tab-content">
    {% for document in output %}
      <div role="tabpanel" class="tab-pane {% if forloop.first %}active{% endif %} output-document" id="document-{{forloop.counter}}">
          {{document.html|safe}}
      </div>
    {% endfor %}

    <div role="tabpanel" class="tab-pane" id="questions">
        <p>Click on any question to change your answer.</p>
        {% for q in all_questions %}
            <p><a href="?q={{q.key}}">{{q.spec.title}}</a></p>
        {% endfor %}        
    </div>
  </div>

</div>

<div style="margin: 2em 0">
  {% with supermodule=task.is_answer_to_unique %}
    {% if supermodule and supermodule.task.editor == request.user %}
      {% if supermodule.task == supermodule.project.root_task %}
        {# return to project #}
        <p class="text-success">Continue with <a href="{{task.project.get_absolute_url}}#tab={{supermodule.question.spec.tab|slugify}}/{{supermodule.question.spec.group|slugify}}/{{supermodule.question.key|slugify}}/{{task.id}}">other modules in {{task.project.title}}</a>.</p>
      {% else %}
        {# return to non-project parent task #}
        <p><a href="{{supermodule.task.get_absolute_url}}" class="btn btn-primary">Continue Answering {{supermodule.task.title}} &raquo;</a></p>
      {% endif %}
    {% else %}
      {# every task, except projects, are now subtasks of other tasks, so this only occurs if a task is a subtask to multiple super-tasks #}
      <p class="text-success">This module is complete. Continue with <a href="{{task.project.get_absolute_url}}">other modules in {{task.project.title}}</a>.</p>
    {% endif %}
  {% endwith %}

</div>

</div> <!-- /col -->
</div> <!-- /row -->

{% endblock %}
