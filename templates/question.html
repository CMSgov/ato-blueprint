{% extends "site_base.html" %}

{% block head_title %}
Next Question: {{q.title}} - GovReady
{% endblock %}

{% block body %}
{% if task.requested_by %}
<div id="requested-by" class="panel panel-warning">
  <div class="panel-heading">{{task.requested_by.user}} has asked for your help completing this module</div>
  <div class="panel-body">
    {{task.requestor_notes}}
  </div>
</div>
{% endif %}

<h1>{{module.title}}</h1>

<div class="row">
  <div class="col-md-6">
    <div id="question" style="margin: 2em 0">
        <form method="post">
            {% csrf_token %}

            <input type="hidden" name="question" value="{{q.id}}">

            {% if last_value %}
              <input type="submit" class="btn btn-danger btn-sm" name="clear-answer" value="Clear Answer" style="float: right"/>
            {% endif %}

            {{prompt|safe}}

            {% if q.type == "text" %}
              <div class="form-group">
                <input name="value" type="text" class="form-control" id="inputctrl" placeholder="{{q.placeholder}}" {% if last_value %}value="{{last_value}}"{% endif %}>
                <p class="help-block">{{q.help}}</p>
              </div>

            {% elif q.type == "email" %}
              <div class="form-group">
                <input name="value" type="email" class="form-control" id="inputctrl" placeholder="email address" {% if last_value %}value="{{last_value}}"{% endif %}>
                <p class="help-block">{{q.help}}</p>
              </div>

            {% elif q.type == "password" %}
              <div class="form-group">
                <input name="value" type="password" class="form-control" id="inputctrl" placeholder="password">
                <p class="help-block">{{q.help}}</p>
              </div>

            {% elif q.type == "longtext" %}
              <div class="form-group">
                <textarea name="value" class="form-control" id="inputctrl" rows="10">{% if last_value %}{{last_value}}{% endif %}</textarea>
                <p class="help-block">{{q.help}}</p>
              </div>

            {% elif q.type == "checkboxes" %}
              <div class="checkbox">
                <label>
                  <input type="checkbox"> Item
                </label>
              </div>
              <p class="help-block">{{q.help}}</p>

            {% elif q.type == "choice" %}
              {% for choice in q.choices %}
              <div class="radio">
                <label>
                  <input name="value" value="{{choice.key}}" type="radio" {% if last_value == choice.key %}checked{% endif %}> {{choice.text}}
                  <p class="help-block">{{choice.help}}</p>
                </label>
              </div>
              {% endfor %}

            {% elif q.type == "yesno" %}
              <div class="radio">
                <label>
                  <input name="value" value="no"  type="radio" {% if last_value == "no" %}checked{% endif %}> No
                </label>
              </div>
              <div class="radio">
                <label>
                  <input name="value" value="yes" type="radio" {% if last_value == "yes" %}checked{% endif %}> Yes
                </label>
              </div>
              <p class="help-block">{{q.help}}</p>

            {% elif q.type == "module" %}
              <div class="form-group">
                <label for="inputctrl">Select a module to answer this question:</label>
                <select name="value" class="form-control" id="inputctrl">
                  {% for m in answer_tasks %}
                    <option value="{{m.id}}">{{m.title}}</option>
                  {% endfor %}
                  <option value="__new">Start a new module on {{answer_module.title}}...</option>
                </select>
                <p class="help-block">{{q.help}}</p>
              </div>

              <p class="help-block">{{q.help}}</p>

            {% else %}
                {{q.type}}

            {% endif %}

          <button type="submit" class="btn btn-success">
            {% if not request.GET.q %}Next{% else %}Submit{% endif %}
            &raquo;
          </button>
        </form>     
    </div>
  </div> <!-- /col -->

  <div class="col-md-6">
  </div> <!-- /col -->
</div> <!-- /row -->

{% if DEBUG %}
<p>
  user: <b>{{user}}</b>
  |
  module: <b>{{module.id}}</b>
  |
  question: <b>{{q.id}}</b>
</p>
{% endif %}

{% endblock %}

{% block extra_body %}
<script>
$(function() {
    $('#inputctrl').focus();

    {% if q.type == "text" or q.type == "password" or q.type == "email" or q.type == "longtext" %}
    function validate_answer() {
        var val = $('#inputctrl').val();
        if (/^ *$/.exec(val))
            return "You must enter something."
        return undefined;
    }

    {% elif q.type == "choice" %}
    function validate_answer() {
        var val = $('#question input[type="radio"]:checked').val();
        if (!val)
            return "You must make a selection."
        return undefined;
    }

    {% else %}

    function validate_answer() { }
    
    {% endif %}

    var form = $("#question > form");
    form.on("submit", function() {
        // client-side validation, block form if not valid
        var problem = validate_answer();
        if (problem) {
            alert(problem);
            return false;
        }

        // ok, submit
        return true;
    })
})

</script>
{% endblock %}