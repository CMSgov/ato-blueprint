{% load static %}

<nav class="navbar navbar-inverse navbar-fixed-top">

  {% include "classification.html" %}

  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-target" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
          <img alt="Logo" src="{% static "img/Blueprint-Logo-KO-230x50_2x.png" %}">
      </a>
    </div>

    <div id="navbar-collapse-target" class="collapse navbar-collapse">
      <ul class="nav navbar-nav navbar-left">
        {% if request.user.is_authenticated and not request.user.is_anonymous %}
          <li><a href="/projects" id="menu-projects">Projects</a></li>
          <li><a href="/controls" id="menu-controls">ARS Catalogs</a></li>
          <li><a href="{% url 'component_library' %}" id="menu-controls">Component Library</a></li>
        {% endif %}
      </ul>

      <ul class="nav navbar-nav navbar-right">

        {% if request.user.is_authenticated %}
        <!-- Create new projects, portfolios -->
          <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" id="create-menu-dropdown">
              <span class="glyphicon glyphicon-plus"></span>
            </a>
            <ul class="dropdown-menu">
              <li><a id="" href="{% url 'store' %}?start=true">Start a new project&hellip;</a></li>
              <li class="dropdown-item-text small text-muted nav-dropdown-item-text">Begin a project from the assessment library. You will be able to choose any available assessment.
              </li>
            </ul>
          </li>
        {% endif %}

        {% if user.is_staff %}
          <li><a href="{% url "guidedmodules_analytics" %}" aria-label="Analytics" tooltip="Analytics"><span class="glyphicon glyphicon-dashboard" aria-label="Analytics" tooltip="Analytics"></span></a></li>
        {% endif %}
        {# if user.can_see_any_org_settings or user.is_staff #}
        {% if user.is_staff %}
        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" id="settings-menu-dropdown"><span class="glyphicon glyphicon-cog" aria-label="Settings" tooltip="Settings"></span>
          </a>
          <ul class="dropdown-menu">
            <li><a href="/settings" id="menu-settings" aria-label="Blueprint settings" tooltip="Blueprint settings"><span class="glyphicon glyphicon-cog" aria-label="Settings"></span> Blueprint settings</a></li>
            {% if user.is_staff %}
              <li><a href="{{settings.SITE_ROOT_URL}}/admin" id="menu-settings" aria-label="Database administration" tooltip="Database administration"><span class="glyphicon glyphicon-cog" aria-label="Database administration"></span> Database administration</a></li>
            {% endif %}
          </ul>
        </li>
        {% endif %}

        <li class="dropdown">
          <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" id="help-menu-dropdown">Help
          </a>
          <ul class="dropdown-menu">
            <li><a href="https://cmsgov.github.io/rato-website/">About Rapid ATO</a></li>
            <li><a href="/love-assessments">Blueprint Support</a></li>
          </ul>
        </li>

        {% if not user.is_anonymous %}{% include "navbar-notifications.html" %}{% endif %}

        {% if request.user.is_authenticated %}
          <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" id="user-menu-dropdown">
              {% with url=request.user.get_profile_picture_absolute_url %}
                {% if url %}
                  <img src="{{url}}" height="30" alt="Profile Picture" class="nav-profile">
                {% endif %}
              {% endwith %}
              {{request.user}}
            </a>
            <ul class="dropdown-menu">
              <li><a href="{% url 'account_settings' %}" id="user-menu-account-settings">Account settings</a></li>
              <li><a href="/api-keys">Your API Keys</a></li>
              {% if can_upgrade_app %}
              <li role="separator" class="divider"></li>
              <li>{% if is_question_page %}<a href="#" onclick="upgrade_app({{task.project.root_task.module.app.id}});">
                  {% else %}
                  <a href="#" onclick="upgrade_app({{project.root_task.module.app.id}});">
                  {% endif %}
                <em class="glyphicon glyphicon-upload"></em> Upgrade project</a>
              </li>
              {% endif %}
              <li role="separator" class="divider"></li>
              <li><a href="/accounts/password/change/">Change password</a></li>
              <li><a href="/accounts/logout/">Log Out</a></li>
            </ul>
          </li>
        {% endif %}
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
